<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>cumbia-image plugin: Plugin to read images with cumbia and display them on a Qt widget</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">cumbia-image plugin
   &#160;<span id="projectnumber">1.0.x</span>
   </div>
   <div id="projectbrief">Show images (e.g. Tango IMAGE) on widgets</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',false,false,'search.php','Search');
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Plugin to read images with cumbia and display them on a Qt widget </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>The plugin offers an interface to display images on a Qt widget using cumbia to get data from any supported engine. If the image is not connected to the cumbia engine, it scales down to a simple viewer at the cost of a single pointer to an unused object.</p>
<dl class="section user"><dt>Data types</dt><dd>Image data types are integrated in cumbia libs <em>since version 1.2.5</em>. <a href="https://elettra-sincrotronetrieste.github.io/cumbia-libs/html/cumbia/html/classCuMatrix.html">CuMatrix</a> is the container for image data. <em>CuMatrices</em> are carried within <a href="https://elettra-sincrotronetrieste.github.io/cumbia-libs/html/cumbia/html/classCuVariant.html">CuVariant</a>s. The latter provide constructors and conversion methods for the supported types. CuMatrix is a template class. You may not need to know these low level details in order to use this plugin. Some flavours of setImage are provided to support a limited subset of data types.</dd></dl>
<p>The image can be drawn </p><ul>
<li><em>scaled</em> to the widget dimensions </li>
<li>within a <em>scroll area</em>, where either the entire or only a portion of an image can be drawn according to the widget dimensions.</li>
</ul>
<dl class="section user"><dt>Scaled images</dt><dd>The image size adapts to the widget geometry and its <em>size hint</em> within a <em>layout</em>. In this configuration, zooming is not possible.</dd></dl>
<div class="image">
<img src="seoyeji-scaled.png" alt=""/>
<div class="caption">
Scaled image</div></div>
<dl class="section user"><dt>Images in a scroll area</dt><dd>In this case, the image can be zoomed either selecting an area with the mouse or programmatically. The layout will affect the scroll area size and leave the image size unaffected.</dd></dl>
<div class="image">
<img src="seoyeji.png" alt=""/>
<div class="caption">
Image in a scroll area</div></div>
<dl class="section user"><dt>Zooming</dt><dd>The user can zoom the image drawing the desired rectangle with the mouse only if the <em>scaleContents</em> property is disabled (default) and no QuImageMouseEventIf is installed through QuImageBaseI::setImageMouseEventInterface</dd></dl>
<div class="image">
<img src="seoyeji-zoom.png" alt=""/>
<div class="caption">
Zooming in *non scaled* mode</div></div>
<p>Unzoom is accomplished clicking with the mouse mid button. Each click goes back one step in the zoom stack.</p>
<dl class="section user"><dt>Loading the plugin</dt><dd>The plugin is loaded with the following few lines of code:</dd></dl>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;QuImagePluginInterface.h&gt;</span></div>
<div class="line"><span class="comment">// load image plugin</span></div>
<div class="line">QObject *image_plo;</div>
<div class="line">QuImagePluginInterface *plugin_i = QuImagePluginInterface::get_instance(cumbia_pool, m_ctrl_factory_pool, &amp;image_plo);</div>
<div class="line"><span class="keywordflow">if</span>(!plugin_i)</div>
<div class="line">     perr(<span class="stringliteral">&quot;MyimageApp: failed to load plugin \&quot;%s\&quot;&quot;</span>, qstoc(QuImagePluginInterface::file_name()));</div>
<div class="line"> <span class="keywordflow">else</span> { <span class="comment">// image here</span></div>
<div class="line"> }</div>
</div><!-- fragment --><p>Once the plugin has been successfully loaded, an interface to an image (namely <a class="el" href="classQuImageBaseI.html" title="Interface to the cumbia widget to display images.">QuImageBaseI</a>) can be obtained with the new_image method. QuImageBase offers a rich interface to control the behaviour of the image. The plugin implementation can either instantiate a <a class="el" href="classQuImageWidget.html" title="QWidget implementing QuImageBaseI.">QuImageWidget</a> or a QuImageGLWidget (incomplete at the moment). They are QWidget instances so their <em>signals and slots</em> can be exploited if deemed convenient. To obtain a reference to them <em>as qwidgets</em>, use QuImageBaseI::asWidget. For example:</p>
<div class="fragment"><div class="line"><a class="code" href="classQuImageBaseI.html">QuImageBaseI</a> *ii = plugin_i-&gt;new_image(<span class="keyword">this</span>);</div>
<div class="line">connect(ii-&gt;asWidget(), SIGNAL(zoomRectChanged(QRect,QRect)), <span class="keyword">this</span>, SLOT(onZoomRectChanged(QRect,QRect)));</div>
<div class="line">ii-&gt;asWidget()-&gt;setProperty(<span class="stringliteral">&quot;scaleContents&quot;</span>, <span class="keyword">false</span>);</div>
<div class="ttc" id="aclassQuImageBaseI_html"><div class="ttname"><a href="classQuImageBaseI.html">QuImageBaseI</a></div><div class="ttdoc">Interface to the cumbia widget to display images.</div><div class="ttdef"><b>Definition:</b> quimageplugininterface.h:73</div></div>
</div><!-- fragment --><p>If you want to enclose the image in a scroll area, a convenience implementation of QScrollArea is provided by the plugin, and a new instance can be obtained with the method new_scroll_area The plugin implementation of the scroll area is offered by the QuImgScrollArea class, which adheres to the <a class="el" href="classQuImgScrollAreaI.html" title="A QScrollArea dedicated to hosting a QuImageBaseI.">QuImgScrollAreaI</a> interface.</p>
<p>Embedding a <a class="el" href="classQuImageBaseI.html" title="Interface to the cumbia widget to display images.">QuImageBaseI</a> into a <a class="el" href="classQuImgScrollAreaI.html" title="A QScrollArea dedicated to hosting a QuImageBaseI.">QuImgScrollAreaI</a> is useful because zooming is automatically integrated with scrolling:</p>
<div class="fragment"><div class="line">MyimageApp(QWidget *parent, CumbiaPool * cu_p, <span class="keyword">const</span> CuControlsFactoryPool&amp; fpoo) : QWidget (parent) {</div>
<div class="line">   <span class="comment">// ...</span></div>
<div class="line">   <span class="comment">// initialize plugin as above</span></div>
<div class="line">   <span class="comment">//</span></div>
<div class="line">   <span class="keywordflow">if</span>(!plugin_i)</div>
<div class="line">       perr(<span class="stringliteral">&quot;MyimageApp: failed to load plugin \&quot;%s\&quot;&quot;</span>, qstoc(QuImagePluginInterface::file_name()));</div>
<div class="line">   <span class="keywordflow">else</span> {</div>
<div class="line">       QHBoxLayout *lo = <span class="keyword">new</span> QHBoxLayout(<span class="keyword">this</span>); <span class="comment">// layout</span></div>
<div class="line">       <a class="code" href="classQuImgScrollAreaI.html">QuImgScrollAreaI</a> *sa = plugin_i-&gt;new_scroll_area(<span class="keyword">this</span>);</div>
<div class="line">       <a class="code" href="classQuImageBaseI.html">QuImageBaseI</a> *ii = plugin_i-&gt;new_image(<span class="keyword">this</span>);</div>
<div class="line">       ii-&gt;setImage(QImage(<span class="stringliteral">&quot;:/seoyeji.png&quot;</span>));</div>
<div class="line">       sa-&gt;setImage(d-&gt;ii);</div>
<div class="line">       lo-&gt;addWidget(sa-&gt;scrollArea());</div>
<div class="line">   }</div>
<div class="ttc" id="aclassQuImgScrollAreaI_html"><div class="ttname"><a href="classQuImgScrollAreaI.html">QuImgScrollAreaI</a></div><div class="ttdoc">A QScrollArea dedicated to hosting a QuImageBaseI.</div><div class="ttdef"><b>Definition:</b> quimageplugininterface.h:407</div></div>
</div><!-- fragment --><dl class="section user"><dt>Connecting the image to cumbia</dt><dd></dd></dl>
<p>To connect a <a class="el" href="classQuImageBaseI.html" title="Interface to the cumbia widget to display images.">QuImageBaseI</a> to cumbia, you have to call first the QuImagePluginInterface::init method on the plugin interface and then connect the image to the source:</p>
<div class="fragment"><div class="line">MyimageApp(QWidget *parent, CumbiaPool * cu_p, <span class="keyword">const</span> CuControlsFactoryPool&amp; fpoo) : QWidget (parent) {</div>
<div class="line">      <span class="comment">// plugin initialization..</span></div>
<div class="line">      <a class="code" href="classQuImageBaseI.html">QuImageBaseI</a> *ii = plugin_i-&gt;new_image(<span class="keyword">this</span>);</div>
<div class="line">      plugin_i-&gt;init(cumbia_pool, m_ctrl_factory_pool);   <span class="comment">// 1</span></div>
<div class="line">      ii-&gt;setSource(<span class="stringliteral">&quot;$1/uchar_image&quot;</span>);                    <span class="comment">// 2</span></div>
<div class="line">      <span class="comment">// ...</span></div>
<div class="line">}</div>
</div><!-- fragment --><p>Here, cumbia_pool and m_ctrl_factory_pool are a pointer to a CumbiaPool instance and a const reference to CuControlsFactoryPool respectively. You will identificate them easily in the application if either it has been generated with <em>cumbia new project</em> or, more generally, if the cumbia engine is already supported. Refer to the <em>cumbia</em> documentation if in doubt.</p>
<div class="image">
<img src="tg_image.png" alt=""/>
<div class="caption">
Reading TangoTest double_image attribute</div></div>
<dl class="section user"><dt>Designer integration</dt><dd></dd></dl>
<p>Since there is no Qt Designer integration (yet) offering a ready to use widget, this is the quickest way to add images to an <em>UI</em>:</p>
<p>In the Qt Designer form editor:</p>
<ul>
<li>add a base <em>QWidget</em> to the Qt Designer <em>form</em> and include it properly in a <em>layout</em> as you would for any other widget </li>
<li>give the widget an appropriate <em>objectName</em>, for example ("img1") <dl class="section note"><dt>Note</dt><dd>Do not add a layout to <em>img1</em> and do not place any child widget within</dd></dl>
In the <em>cpp implementation</em> file, a one liner does the job (1):</li>
</ul>
<div class="fragment"><div class="line">MyimageApp(QWidget *parent, CumbiaPool * cu_p, <span class="keyword">const</span> CuControlsFactoryPool&amp; fpoo) : QWidget (parent) {</div>
<div class="line">       <span class="comment">// plugin initialization..</span></div>
<div class="line">       <a class="code" href="classQuImageBaseI.html">QuImageBaseI</a> *ii = plugin_i-&gt;new_image(<span class="keyword">this</span>);</div>
<div class="line">       <span class="comment">// insert the image into a QHBoxLayout automatically added to *ui-&gt;img1*</span></div>
<div class="line">       plugin_i-&gt;layout(ii, ui-&gt;img1); <span class="comment">// (1) layout ii into ui-&gt;img1</span></div>
<div class="line">       <span class="comment">// ...</span></div>
<div class="line">}</div>
</div><!-- fragment --><p>The <em>examples</em> directory contains a project named <em>cudisplay-designer</em> realised with this technique.</p>
<dl class="section user"><dt>Further reading</dt><dd>The <a class="el" href="classQuImageWidget.html" title="QWidget implementing QuImageBaseI.">QuImageWidget</a> and its incomplete counterpart QuImageGLWidget are QWidget and QOpenGLWidget implementing <a class="el" href="classQuImageBaseI.html" title="Interface to the cumbia widget to display images.">QuImageBaseI</a>. The QuImageBaseI::asWidget allows signal/slot connections to them as well as access to Qt properties. QuImgScrollArea implements <a class="el" href="classQuImgScrollAreaI.html" title="A QScrollArea dedicated to hosting a QuImageBaseI.">QuImgScrollAreaI</a></dd></dl>
<p>See also <a class="el" href="classQuImgScrollAreaI.html" title="A QScrollArea dedicated to hosting a QuImageBaseI.">QuImgScrollAreaI</a>, <a class="el" href="classQuImageBaseI.html" title="Interface to the cumbia widget to display images.">QuImageBaseI</a>, <a class="el" href="classQuImageWidget.html" title="QWidget implementing QuImageBaseI.">QuImageWidget</a>, QuImgScrollArea.</p>
<dl class="section user"><dt>Examples</dt><dd>The directory <em>examples/cudisplay</em> provides a working application to read images with cumbia:</dd></dl>
<blockquote class="doxtable">
<p>cudisplay test/device/1/double_image </p>
</blockquote>
<p>The cudisplay utility can be installed executing qmake with the <em>INSTALL_DIR</em> option:</p>
<blockquote class="doxtable">
<p>qmake INSTALL_DIR=/usr/local/cumbia-libs/bin </p>
</blockquote>
<p>Under <em>examples</em>, the project <em>cudisplay-designer</em> is the equivalent realised with the Qt designer. </p>
</div></div><!-- PageDoc -->
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
